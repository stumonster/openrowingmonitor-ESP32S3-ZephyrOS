# ==============================================================================
#  OPEN ROWING MONITOR - PRODUCTION CONFIGURATION
#  Version: 1.0.0
# ==============================================================================

# ==============================================================================
#  USER TUNING (Edit these for your specific rower)
# ==============================================================================

# 1. Hardware Setup
CONFIG_ORM_IMPULSES_PER_REV=3

# Standard Flywheel Inertia (x10000). 5000 = 0.5 kg*m^2.
# Check JS profile for your model (e.g., WRX700 is 7200, C2 is ~1000)
CONFIG_ORM_FLYWHEEL_INERTIA_X10000=19

# 2. Calibration
# Standard Concept2 Constant. Higher = fewer meters per stroke.
CONFIG_ORM_MAGIC_CONSTANT_X10000=28000

# Starting/Static Drag Factor (scaled x1M in physics, usually 1500-4500)
CONFIG_ORM_DRAG_FACTOR=45

# 3. Engine Behavior
CONFIG_ORM_AUTO_ADJUST_DRAG_FACTOR=y

# Length of the running average for Drag (strokes)
CONFIG_ORM_DAMPING_CONSTANT_SMOOTING=3

# Noise Filter: Number of samples to confirm Drive vs Recovery
CONFIG_ORM_FLANK_LENGTH=3

# Smoothens power reading. Higher smoother Lower more responsive
CONFIG_ORM_SMOOTHING=3

# 4. Timing Limits (Seconds x10000)
# Min pulse time (0.0045s). Increase if you get double-triggering noise.
CONFIG_ORM_MIN_TIME_BETWEEN_IMPULSE_X10000=45

# Max pulse time (2.0s). JS default for active rowing.
CONFIG_ORM_MAX_TIME_BETWEEN_IMPULSE_X10000=6667

# Timeout for stop (3.0s)
CONFIG_ORM_MAX_IMPULSE_TIME_BEFORE_PAUSE_X10000=30000

# ==============================================================================
#  ZEPHYR SYSTEM CONFIGURATION
# ==============================================================================

# Core C++ Support
CONFIG_CPP=y
CONFIG_STD_CPP17=y
CONFIG_GLIBCXX_LIBCPP=y
CONFIG_NEWLIB_LIBC=y

# ==============================================================================
#  LOGGING (Production Mode)
# ==============================================================================

CONFIG_LOG=y
CONFIG_LOG_MODE_DEFERRED=y
CONFIG_LOG_BUFFER_SIZE=2048

# Production log levels (change to LOG_LEVEL_INF or LOG_LEVEL_WRN for release)
# 3=INF, 2=WRN, 1=ERR
CONFIG_LOG_DEFAULT_LEVEL=3

# Disable debug logging in production
# CONFIG_ROWING_ENGINE_LOG_LEVEL_INF=y
# CONFIG_GPIO_TIMER_SERVICE_LOG_LEVEL_INF=y
# CONFIG_BLE_MANAGER_LOG_LEVEL_INF=y
# CONFIG_FTMS_LOG_LEVEL_INF=y

# ==============================================================================
#  BLUETOOTH LOW ENERGY
# ==============================================================================

CONFIG_BT=y
CONFIG_BT_PERIPHERAL=y
CONFIG_BT_DEVICE_NAME="Rowing-Monitor"
CONFIG_BT_DEVICE_APPEARANCE=833

# Bluetooth Performance & Buffers
CONFIG_BT_GATT_DYNAMIC_DB=y
CONFIG_BT_L2CAP_TX_MTU=247
CONFIG_BT_BUF_ACL_TX_SIZE=251
CONFIG_BT_L2CAP_TX_BUF_COUNT=20
CONFIG_BT_BUF_ACL_TX_COUNT=20
CONFIG_BT_BUF_EVT_RX_COUNT=25

# Connection Parameters (optimized for rowing apps)
CONFIG_BT_PERIPHERAL_PREF_MIN_INT=24
CONFIG_BT_PERIPHERAL_PREF_MAX_INT=40

# Connectivity Limits
CONFIG_BT_MAX_CONN=2
CONFIG_BT_MAX_PAIRED=2
CONFIG_BT_CONN_CHECK_NULL_BEFORE_CREATE=y

# ==============================================================================
#  MEMORY CONFIGURATION (Production-Optimized)
# ==============================================================================

# Main thread stack
CONFIG_MAIN_STACK_SIZE=12288

# Physics thread stack
CONFIG_GPIO_PHYSICS_THREAD_STACK_SIZE=8192

# Heap size
CONFIG_HEAP_MEM_POOL_SIZE=65536
CONFIG_SYS_HEAP_RUNTIME_STATS=y

# ==============================================================================
#  PRODUCTION BUILD SETTINGS
# ==============================================================================

# Optimize for size (or CONFIG_SIZE_OPTIMIZATIONS=y for even smaller binary)
CONFIG_SPEED_OPTIMIZATIONS=y

# Disable debugging features in production
CONFIG_DEBUG=n
CONFIG_DEBUG_OPTIMIZATIONS=n
CONFIG_DEBUG_INFO=n

# Thread monitoring (keep lightweight version)
CONFIG_THREAD_NAME=y
CONFIG_THREAD_STACK_INFO=y

# Assert configuration (reduced for production)
CONFIG_ASSERT=y
# Only critical asserts
CONFIG_ASSERT_LEVEL=1

# Disable coredump in production (saves flash space)
CONFIG_DEBUG_COREDUMP=n
