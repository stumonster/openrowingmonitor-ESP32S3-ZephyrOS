# ==============================================================================
#  USER TUNING (Edit these for your specific rower)
# ==============================================================================

# 1. Hardware Setup
CONFIG_ORM_IMPULSES_PER_REV=1
# Standard Flywheel Inertia (x10000). 5000 = 0.5 kg*m^2.
# Check JS profile for your model (e.g., WRX700 is 7200, C2 is ~1000)
CONFIG_ORM_FLYWHEEL_INERTIA_X10000=20

# 2. Calibration
# Standard Concept2 Constant. Higher = fewer meters per stroke.
CONFIG_ORM_MAGIC_CONSTANT_X10000=28000
# Starting/Static Drag Factor (scaled x1M in physics, usually 1500-4500)
CONFIG_ORM_DRAG_FACTOR=180

# 3. Engine Behavior
CONFIG_ORM_AUTO_ADJUST_DRAG_FACTOR=y
# Length of the running average for Drag (strokes)
CONFIG_ORM_DAMPING_CONSTANT_SMOOTING=5
# Noise Filter: Number of samples to confirm Drive vs Recovery
CONFIG_ORM_FLANK_LENGTH=2

# 4. Timing Limits (Seconds x10000)
# Min pulse time (0.014s). Increase if you get double-triggering noise.
CONFIG_ORM_MIN_TIME_BETWEEN_IMPULSE_X10000=140
# Max pulse time (0.5s). JS default for active rowing.
CONFIG_ORM_MAX_TIME_BETWEEN_IMPULSE_X10000=10000
# Timeout for stop (3.0s)
CONFIG_ORM_MAX_IMPULSE_TIME_BEFORE_PAUSE_X10000=30000

# ==============================================================================
#  ZEPHYR SYSTEM CONFIGURATION
# ==============================================================================

# Core C++ Support
CONFIG_CPP=y
CONFIG_STD_CPP17=y
CONFIG_GLIBCXX_LIBCPP=y
CONFIG_NEWLIB_LIBC=y

# Floating Point Unit
CONFIG_FPU=y

# System Memory & Logging
CONFIG_MAIN_STACK_SIZE=4096
CONFIG_LOG=y
CONFIG_LOG_MODE_IMMEDIATE=y
CONFIG_LOG_MODE_DEFERRED=y
CONFIG_LOG_BUFFER_SIZE=2048

# Bluetooth Low Energy
CONFIG_BT=y
CONFIG_BT_PERIPHERAL=y
CONFIG_BT_DEVICE_NAME="Rowing-Monitor"
CONFIG_BT_DEVICE_APPEARANCE=833

# Bluetooth Performance & Buffers
CONFIG_BT_GATT_DYNAMIC_DB=y
CONFIG_BT_L2CAP_TX_MTU=247
CONFIG_BT_BUF_ACL_TX_SIZE=251
CONFIG_BT_L2CAP_TX_BUF_COUNT=10
CONFIG_BT_BUF_ACL_TX_COUNT=10
CONFIG_BT_BUF_EVT_RX_COUNT=11
CONFIG_BT_PERIPHERAL_PREF_MIN_INT=24
CONFIG_BT_PERIPHERAL_PREF_MAX_INT=40

# Connectivity Limits
CONFIG_BT_MAX_CONN=2
CONFIG_BT_MAX_PAIRED=2
CONFIG_BT_CONN_CHECK_NULL_BEFORE_CREATE=y

# ==============================================================================
#  DEBUGGING & DIAGNOSTICS
# ==============================================================================

# 1. Compiler Settings for Debugging
# "Og" optimization gives the best balance of debuggability and performance.
# Do NOT use CONFIG_NO_OPTIMIZATIONS=y as it might break timing-sensitive BLE/ISR code.
CONFIG_DEBUG=y
CONFIG_DEBUG_OPTIMIZATIONS=y

# 2. Crash Behavior (The "Trap")
# Since RESET_ON_FATAL_ERROR is tricky on v4.1, use this modern equivalent.
# This forces the CPU to loop forever on panic, keeping JTAG alive.
# CONFIG_K_PANIC_SELF_HALT=y
CONFIG_DEBUG_COREDUMP=y

# 3. Thread Analysis (Find the Stack Overflow)
# This enables the "zephyr stack" command in GDB/Zed to see memory usage.
CONFIG_THREAD_ANALYZER=y
CONFIG_THREAD_NAME=y

# 4. Watchdogs (DISABLE THESE)
# If these are on, the chip will reset while you are paused in the debugger.
# CONFIG_INT_WDT=n
CONFIG_TASK_WDT=n
# ESP32 Specific Watchdogs
# CONFIG_ESP32_INT_WDT=n
# CONFIG_ESP32_TASK_WDT=n
