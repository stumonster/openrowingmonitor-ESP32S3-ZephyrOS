# ------------------------------------------------
# Core C++ Support
# ------------------------------------------------
CONFIG_CPP=y
CONFIG_STD_CPP17=y

# ------------------------------------------------
# Standard Library Support
# ------------------------------------------------
CONFIG_GLIBCXX_LIBCPP=y
CONFIG_NEWLIB_LIBC=y

# ------------------------------------------------
# Physics & Math Performance
# ------------------------------------------------
CONFIG_FPU=y

# ------------------------------------------------
# System Tuning
# ------------------------------------------------
# REMOVE THIS LINE: CONFIG_CPP_MAIN=y
# CONFIG_HEAP_MEM_POOL_SIZE=16384
CONFIG_MAIN_STACK_SIZE=4096

# ------------------------------------------------
# Logging
# ------------------------------------------------
CONFIG_LOG=y
CONFIG_LOG_MODE_IMMEDIATE=y

# ------------------------------------------------
# Enable Multicore Support
# ------------------------------------------------
# CONFIG_SMP=y
# CONFIG_MP_MAX_NUM_CPUS=2

# ------------------------------------------------
# Flash & Storage (Internal 16MB)
# ------------------------------------------------
CONFIG_FLASH=y
CONFIG_FLASH_MAP=y
CONFIG_FLASH_PAGE_LAYOUT=y

CONFIG_FILE_SYSTEM=y

# CORRECTED: Use the new LittleFS symbol
CONFIG_FILE_SYSTEM_LITTLEFS=y

# Allow CPU to write to flash (Critical for N16)
# CONFIG_MPU_ALLOW_FLASH_WRITE=y # Hmm

# LittleFS Tuning (Optional)
CONFIG_FS_LITTLEFS_CACHE_SIZE=512
CONFIG_FS_LITTLEFS_FMP_DEV=y

CONFIG_FILE_SYSTEM_MKFS=y

# ------------------------------------------------
# Hardware Specifics (ESP32-S3 N16R8)
# ------------------------------------------------
# 1. Flash Size: 16MB
CONFIG_ESPTOOLPY_FLASHSIZE_16MB=y

# 2. Flash Mode: DIO (Safest)
CONFIG_ESPTOOLPY_FLASHMODE_DIO=y
CONFIG_ESPTOOLPY_FLASHFREQ_80M=y

# 3. PSRAM (External RAM)
# ONLY Enable this. Remove MODE_OCT and SPEED_80M.
# The driver will auto-detect Octal mode from the chip hardware.
# CONFIG_ESP_SPIRAM=y
# CONFIG_ESP_SPIRAM_MEMTEST=y

# ------------------------------------------------
# Bluetooth Low Energy Settings
# ------------------------------------------------

# Basic Bluetooth Setup
CONFIG_BT=y
CONFIG_BT_PERIPHERAL=y
CONFIG_BT_DEVICE_NAME="Rowing-Monitor"
CONFIG_BT_DEVICE_APPEARANCE=833

# FTMS requires some extra GATT features
CONFIG_BT_GATT_DYNAMIC_DB=y
CONFIG_BT_L2CAP_TX_MTU=247
CONFIG_BT_BUF_ACL_TX_SIZE=251

# Optional: Enable Settings if you want to save the BLE "Identity" (Bonding)
# CONFIG_BT_SETTINGS=y
# CONFIG_FLASH=y
# CONFIG_NVS=y

# Increase number of Bluetooth transmit buffers
CONFIG_BT_L2CAP_TX_BUF_COUNT=10
CONFIG_BT_BUF_ACL_TX_COUNT=10
CONFIG_BT_BUF_EVT_RX_COUNT=11

# Ensure we don't crash on null connection during create
CONFIG_BT_CONN_CHECK_NULL_BEFORE_CREATE=y
