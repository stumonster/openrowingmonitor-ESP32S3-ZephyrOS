# ==============================================================================
#  USER TUNING (Edit these for your specific rower)
# ==============================================================================

# 1. Hardware Setup
CONFIG_ORM_IMPULSES_PER_REV=3
# Standard Flywheel Inertia (x10000). 5000 = 0.5 kg*m^2.
# Check JS profile for your model (e.g., WRX700 is 7200, C2 is ~1000)
CONFIG_ORM_FLYWHEEL_INERTIA_X10000=19

# 2. Calibration
# Standard Concept2 Constant. Higher = fewer meters per stroke.
CONFIG_ORM_MAGIC_CONSTANT_X10000=28000
# Starting/Static Drag Factor (scaled x1M in physics, usually 1500-4500)
CONFIG_ORM_DRAG_FACTOR=45

# 3. Engine Behavior
CONFIG_ORM_AUTO_ADJUST_DRAG_FACTOR=y
# Length of the running average for Drag (strokes)
CONFIG_ORM_DAMPING_CONSTANT_SMOOTING=5
# Noise Filter: Number of samples to confirm Drive vs Recovery
CONFIG_ORM_FLANK_LENGTH=3

# 4. Timing Limits (Seconds x10000)
# Min pulse time (0.0045s). Increase if you get double-triggering noise.
CONFIG_ORM_MIN_TIME_BETWEEN_IMPULSE_X10000=45
# Max pulse time (2.0s). JS default for active rowing.
CONFIG_ORM_MAX_TIME_BETWEEN_IMPULSE_X10000=6667
# Timeout for stop (3.0s)
CONFIG_ORM_MAX_IMPULSE_TIME_BEFORE_PAUSE_X10000=30000

# ==============================================================================
#  POWER MANAGEMENT
# ==============================================================================

# Enable Zephyr Power Management subsystem
# CONFIG_PM=y
# CONFIG_PM_DEVICE=y
# CONFIG_POWEROFF=y

# Power Manager Settings
# CONFIG_POWER_INACTIVITY_TIMEOUT_MS=300000

# CONFIG_UART_CONSOLE_ON_DEV_NAME="UART_0"

# ==============================================================================
#  ZEPHYR SYSTEM CONFIGURATION
# ==============================================================================

# Core C++ Support
CONFIG_CPP=y
CONFIG_STD_CPP17=y
CONFIG_GLIBCXX_LIBCPP=y
CONFIG_NEWLIB_LIBC=y

# System Memory & Logging
# CONFIG_MAIN_STACK_SIZE=4096
CONFIG_LOG=y
CONFIG_LOG_MODE_IMMEDIATE=y
CONFIG_LOG_MODE_DEFERRED=y
CONFIG_LOG_BUFFER_SIZE=2048

# Bluetooth Low Energy
CONFIG_BT=y
CONFIG_BT_PERIPHERAL=y
CONFIG_BT_DEVICE_NAME="Rowing-Monitor"
CONFIG_BT_DEVICE_APPEARANCE=833

# Bluetooth Performance & Buffers
CONFIG_BT_GATT_DYNAMIC_DB=y
CONFIG_BT_L2CAP_TX_MTU=247
CONFIG_BT_BUF_ACL_TX_SIZE=251
CONFIG_BT_L2CAP_TX_BUF_COUNT=10
CONFIG_BT_BUF_ACL_TX_COUNT=10
CONFIG_BT_BUF_EVT_RX_COUNT=11
CONFIG_BT_PERIPHERAL_PREF_MIN_INT=24
CONFIG_BT_PERIPHERAL_PREF_MAX_INT=40

# Connectivity Limits
CONFIG_BT_MAX_CONN=2
CONFIG_BT_MAX_PAIRED=2
CONFIG_BT_CONN_CHECK_NULL_BEFORE_CREATE=y

# ==============================================================================
#  SYSTEM MONITORING & DIAGNOSTICS
# ==============================================================================

# Thread Monitoring (Already enabled, keeping for reference)
CONFIG_THREAD_ANALYZER=y
CONFIG_THREAD_NAME=y
CONFIG_THREAD_MONITOR=y

# Stack Sentinel - Detects stack overflow BEFORE it crashes
CONFIG_THREAD_STACK_INFO=y

# Enable runtime stack size checking
CONFIG_THREAD_RUNTIME_STATS=y

# Optional: Enable physics profiling (comment out to save overhead)
# CONFIG_ENABLE_PHYSICS_PROFILING=y

# Optional: More verbose logging for debugging
# CONFIG_LOG_MODE_IMMEDIATE=y  # Already enabled

# Heap monitoring (if you use dynamic allocation like k_malloc)
CONFIG_SYS_HEAP_RUNTIME_STATS=y

# ==============================================================================
#  STACK SIZES (Adjust these based on monitoring results)
# ==============================================================================

# Main thread stack
CONFIG_MAIN_STACK_SIZE=8192

# Physics thread stack (increase from 2048)
CONFIG_PHYSICS_THREAD_STACK_SIZE=4096

# Heap size
CONFIG_HEAP_MEM_POOL_SIZE=65536
# ==============================================================================
#  CRASH DEBUGGING
# ==============================================================================

# Keep these enabled during testing
CONFIG_DEBUG=y
CONFIG_DEBUG_OPTIMIZATIONS=y
CONFIG_DEBUG_INFO=y

# Coredump to help analyze crashes
CONFIG_DEBUG_COREDUMP=y
CONFIG_DEBUG_COREDUMP_BACKEND_LOGGING=y

# Assert on stack overflow
CONFIG_ASSERT=y
CONFIG_ASSERT_LEVEL=2
