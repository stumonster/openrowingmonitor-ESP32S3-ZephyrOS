# ==============================================================================
#  CRASH DEBUGGING CONFIGURATION
#  Add this to your prj_debug.conf to get better crash information
# ==============================================================================

# Built in monitor to check tread stack usage and overall heap usage
CONFIG_SYSM_ENABLE_MONITORING=y
CONFIG_GPIO_ENABLE_PHYSICS_PROFILING=y

CONFIG_INIT_STACKS=y
CONFIG_THREAD_STACK_INFO=y

# Enable coredump for crash analysis
CONFIG_DEBUG_COREDUMP=y
CONFIG_DEBUG_COREDUMP_BACKEND_LOGGING=y
CONFIG_DEBUG_COREDUMP_MEMORY_DUMP_MIN=y

# Enable exception handling details
CONFIG_EXCEPTION_DEBUG=y

# Enable watchdog (to catch infinite loops)
CONFIG_WATCHDOG=y

# Enable fault dump (detailed register dump on crash)
CONFIG_FAULT_DUMP=2

# Enable thread monitoring to see what thread crashed
CONFIG_THREAD_MONITOR=y
CONFIG_THREAD_NAME=y
CONFIG_THREAD_STACK_INFO=y


# Enable heap poisoning (catches use-after-free)
CONFIG_SYS_HEAP_VALIDATE=y

# Enable stack canaries (catches stack overflows)
CONFIG_STACK_CANARIES=y
CONFIG_STACK_SENTINEL=y

# Increase log buffer to catch more before crash
CONFIG_LOG_BUFFER_SIZE=4096

# Disable optimizations for easier debugging
CONFIG_NO_OPTIMIZATIONS=y
CONFIG_DEBUG_OPTIMIZATIONS=y

# ==============================================================================
#  BLE DEBUGGING FOR ZEPHYR 4.1.0
# ==============================================================================
CONFIG_DEBUG_THREAD_INFO=y
# # Enable BLE logging subsystem
# # CONFIG_BT_LOG=y

# # Set BLE log level to DEBUG
# CONFIG_BT_LOG_LEVEL_DBG=y

# # Enable specific BLE module logging
# CONFIG_BT_HCI_CORE_LOG_LEVEL_DBG=y
# CONFIG_BT_CONN_LOG_LEVEL_DBG=y
# CONFIG_BT_GATT_LOG_LEVEL_DBG=y
# CONFIG_BT_ATT_LOG_LEVEL_DBG=y
# CONFIG_BT_L2CAP_LOG_LEVEL_DBG=y

# # Monitor BLE buffer usage (very useful for debugging)
# # CONFIG_BT_DEBUG_MONITOR=y

# # If you want to see HCI commands (very verbose!):
# # CONFIG_BT_HCI_LOG_LEVEL_DBG=y

# # Note: The old CONFIG_BT_DEBUG_* options were deprecated in Zephyr 3.x
# # and removed in 4.x. Use the _LOG_LEVEL_ variants above instead.
